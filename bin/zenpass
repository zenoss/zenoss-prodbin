#! /usr/bin/env bash
#############################################################################
# This program is part of Zenoss Core, an open source monitoring platform.
# Copyright (C) 2007, Zenoss Inc.
#
# This program is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License version 2 as published by
# the Free Software Foundation.
#
# For complete information please visit: http://www.zenoss.com/oss/
#############################################################################

cd $ZENHOME

echo -n 'Password for the Zenoss "admin" user: '
stty -echo
read ZOPEPASSWORD
echo
stty echo

test -z "$ZOPEHOME" && export ZOPEHOME=$ZENHOME

$ZOPEHOME/bin/zpasswd.py -u admin -p $ZOPEPASSWORD inituser
zopectl stop
zopectl start
sleep 2
for file in zenperfsnmp zencommand zenperfxmlrpc zenprocess
do
    sed -e "s/zopepassword.*/zopepassword $ZOPEPASSWORD/" < \
        $ZENHOME/etc/${file}.conf > /tmp/${file}.conf
    mv /tmp/${file}.conf $ZENHOME/etc
    $file restart
done
