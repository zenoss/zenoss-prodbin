<span tal:replace="structure here/events_html_header"/>
<span metal:use-macro="here/top/macros/header" />
<span metal:define-macro="body">
<script metal:use-macro="here/miscmacros/macros/popupwindow"></script>
<script type="text/javascript" src="/zport/portal_skins/zenmodel/datePicker.js">
</script>
<script type="text/javascript" 
        src="/zport/portal_skins/zenmodel/submitViaEnter.js"></script>
<script type="text/javascript">
function datePickerClosed(targetInput) {
    if (targetInput.name == "startDate") {
        startDate = targetInput.value;
        endDateInput = targetInput.form.endDate;
    } else {
        startDate = targetInput.form.startDate.value;
        endDateInput = targetInput;
    } 
    var sdate = getFieldDate(startDate);
    var edate = getFieldDate(endDateInput.value);
    if (sdate.getTime() + 86400000 >= edate.getTime()) {
        edate = new Date(sdate.getTime() + 86400000);
        endDateInput.value = getDateString(edate);
    }
    return true;
};
</script>
<br>
<form method="post" tal:attributes="action request/URL"
    tal:define="
    whereclause request/ev_whereclause | here/eventWhere | string:;
    orderby here/ZenEventHistory/defaultOrderby;
    resultFields request/ev_resultfields | here/getResultFields;
    tableName string:viewhistoryevents;
    ztm     here/ZenTableManager;
    deftsort python:ztm.getTableState(tableName,sortedHeader='');
    startdate python:ztm.setReqTableState(
                    tableName,'startDate', default=here.yesterdayDate());
    enddate python:ztm.setReqTableState(
                    tableName,'endDate', default=here.todayDate());
    ">
<span metal:define-macro="events">
<table class="zentable" cellpadding="3" cellspacing="1">
    <tr class=tableheader>
    <td>Start Date: 
    <input class="tableheader" type="text" name="startDate" readonly="true"
        tal:attributes="value startdate"/>
    <input class="tableheader" type="button" value="select" 
        onclick="displayDatePicker('startDate');"/>
    </td>
    <td>End Date: 
    <input class="tableheader" type="text" name="endDate" readonly="true"
        tal:attributes="value enddate"/>
    <input class="tableheader" type="button" value="select" 
        onclick="displayDatePicker('endDate');" />
    </td>
    <td>
    <input class="tableheader" type="submit" name="search" value=" Search " />
    </td>
    </tr>
</table>
<br>
<table class="zentable" cellpadding="3" cellspacing="1" 
    tal:define="
    sevlevel python:ztm.setReqTableState(
                    tableName,'severity', default=0, reset=True);
    objects python:here.getEventHistoryList(severity=sevlevel);
    batch python:ztm.getBatch(tableName,objects);
    evcolspan python:len(resultFields)+1;"
    >
    <tal:block metal:use-macro="here/viewEvents/macros/listbody"/>
</table>
</span>
</form>
</span>
<span tal:replace="structure here/standard_html_footer"/>
