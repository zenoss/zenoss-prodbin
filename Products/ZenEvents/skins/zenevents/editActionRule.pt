<tal:block metal:use-macro="here/templates/macros/page2">
<tal:block metal:fill-slot="contentPane">
<form id="actionRule" method="post" tal:attributes="action here/absolute_url_path">
<input type="hidden" name="zenScreenName" tal:attributes="value template/id"/>
<table class="zentable"  cellpadding="3" cellspacing="1">
<tr tal:define="message request/message | string:State at time:">
    <th class=tabletitle colspan="6"
        tal:content="string:${message} ${here/getNowString}" />
</tr>
<tr>
  <td class="tableheader">Delay</td>
  <td class="tablevalues">
    <input class="tablevalues" type="text" name="delay:int" size="5"
        tal:attributes="value here/delay" />
  </td>
  <td class="tableheader">Enabled</td>
  <td class="tablevalues">
    <select class="tablevalues" name="enabled:boolean">
        <option tal:repeat="e python:(True,False)" tal:content="e"
                tal:attributes="value e; selected python:e==here.enabled"/>
    </select>
  </td>
</tr>
<tr>
  <td class="tableheader">Action</td>
  <td class="tablevalues">
    <select class="tablevalues" name="action">
        <option tal:repeat="a here/actionTypes" tal:content="a"
                tal:attributes="value a; selected python:a==here.action"/>
    </select>
  </td>
  <td class="tableheader">Address (optional)</td>
  <td class="tablevalues">
    <input class="tablevalues" type="text" name="targetAddr" size="25"
        tal:attributes="value here/targetAddr" />
  </td>
</tr>
<tr>
<td class="tableheader" colspan="6">Where</td>
</tr>
<tr>
<td class="tablevalues" colspan="6">


<script type="text/javascript" src="/zport/js/query.js"></script>

<span id="query">
  <span id="filters">
    <table summary="Action filters">
      <tbody>
	<tr><td colspan='4'>
	   <label for="add_filter" class="tablevalues">Add filter</label>&nbsp;
	   <select name="add_filter" id="add_filter" class="tablevalues">
	     <option></option>
	     <option value="severity">Severity</option>
	     <option value="eventState">Event State</option>
	     <option value="prodState">Production State</option>
	     <option value="count">Count</option>
	     <option value="summary">Summary</option>
	     <option value="device">Device</option>
	     <option value="deviceClass">Device Class</option>
	     <option value="eventClass">Event Class</option>
	     <option value="eventClassKey">Event Class Key</option>
	     <option value="lastAge">Time since last update</option>
	     <option value="firstAge">Time since event creation</option>
	     <option value="changeAge">Time since last state change</option>
	     <option value="manager">Manager</option>
	     <option value="agent">Agent</option>
	     <option value="location">Location</option>
	     <option value="facility">Facility</option>
	     <option value="priority">Priority</option>
	     <option value="component">Component</option>
	     <option value="message">Message</option>
	     <option value="ipAddress">IP Address</option>
	     <option value="location">Location</option>
	     <option value="systems">Systems</option>
	     <option value="deviceGroups">Device Groups</option>
	     <option value="ownerId">Owner Id</option>
	     <option value="ntevid">ntevid</option>
 	   </select>	      
	   <input type="submit" name="add" value="+" class="tablevalues"/>
         </td></tr>
       </tbody>
    </table>
  </span>
</span>


</td>
</tr>
<tr>
<td class="tablevalues" colspan="6" tal:content="here/where"/>
</tr>
<tr>
<td class="tableheader" colspan="6">Message (or Subject)</td>
</tr>
<tr>
<td class="tablevalues" colspan="6">
    <input class="tablevalues" type="text" name="format" size="75"
        tal:attributes="value here/format" />
</td>
</tr>
<tal:block tal:condition="python:here.action == 'email'">
<tr>
<td class="tableheader" colspan="6">Body</td>
</tr>
<tr>
<td class="tablevalues" colspan="6">
    <textarea class="tablevalues" rows="6" cols="75" name="body:text"
        tal:content="here/body">
    </textarea>
</td>
</tr>
</tal:block>
<tr>
<td class="tableheader" colspan="6">Clear Message (or Subject)</td>
</tr>
<tr>
<td class="tablevalues" colspan="6">
    <input class="tablevalues" type="text" name="clearFormat" size="75"
        tal:attributes="value here/clearFormat" />
</td>
</tr>
<tal:block tal:condition="python:here.action == 'email'">
<tr>
<td class="tableheader" colspan="6">Clear Body</td>
</tr>
<tr>
<td class="tablevalues" colspan="6">
    <textarea class="tablevalues" rows="6" cols="75" name="clearBody:text"
        tal:content="here/clearBody">
    </textarea>
</td>
</tr>
</tal:block>
<tr>
    <td class="tableheader" colspan="6">
        <input class="tableheader" type="submit" value=" Save "
            name="manage_editActionRule:method" />
    </td>
</tr>
</table>
<p>
The Where field above is a standard SQL where clause.  Message Format is a
python format string.  Fields are specified as %(fieldname)s.  The list of 
fields available in the event database is: 
<span tal:content="python: ', '.join(here.ZenEventManager.getFieldList())"/>.
</p>
</form>

<script tal:content="structure here/getWhereClauseAsJavaScript" type="text/javascript"/>

</tal:block>
</tal:block>
