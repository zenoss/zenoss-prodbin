<tal:block metal:use-macro="here/templates/macros/page2WithZenossAll">
<tal:block metal:fill-slot="contentPane">

<tal:block tal:content="structure python:here.auditRunReport()"/>
<tal:block tal:replace="structure string:<script language=&quot;javascript&quot; type=&quot;text/javascript&quot;>
var absoluteUrlPath = &quot;${here/absolute_url_path}&quot;;
var reportId = &quot;${here/getPrimaryId}&quot;;
</script>" />


<form method="post" target="_blank" id="printableForm" tal:attributes="
        action python:here.absolute_url_path() + '/viewGraphReportClean';">
</form>

<form method="post" 
    tal:attributes="action string:${here/absolute_url_path}/${template/id}">

<script language="javascript" type="text/javascript">

function CreateFormField(theForm, name, value) {
    var newField = document.createElement('INPUT');
    newField.setAttribute('type', 'HIDDEN');
    newField.setAttribute('name', name);
    newField.setAttribute('value', value);
    theForm.appendChild(newField);
}

function ShowPrintable() {
    printbleFrm = document.getElementById('printableForm');
    while (printbleFrm.hasChildNodes())
        printbleFrm.removeChild(printbleFrm.firstChild);
    var numGraphs = 0;
    for (var name in ZenGraphs) {
        if (ZenGraphs.hasOwnProperty(name)) {
            var graph = ZenGraphs[name],
                src = graph[0],
                title = graph[1],
                i = numGraphs;
            var graph = document.getElementById('graph_' + numGraphs);
            CreateFormField(printbleFrm, 'graph_' + numGraphs, graph.src);
            CreateFormField(printbleFrm, 'title_' + numGraphs, title);
            numGraphs++;
        }
    }

    // append the drange to the viewGraphReportClean url
    var drange = document.getElementById('drange_select');
    if (drange) {
       var selected = drange.options[drange.selectedIndex].value;
       if (selected) {
           CreateFormField(printbleFrm, 'drange', selected);
       }
    }
    printbleFrm.submit();
}
</script>


<tal:block tal:define="tableName string:graphreport;
    tabletitle here/id;
    drange python: here.ZenTableManager.setReqTableState(
    tableName,'drange',129600)">
    <input type='hidden' name='tableName' tal:attributes="value tableName" />


<!-- BEGIN TABLE CONTENTS -->

    <div id="graphs" >
    </div>
    
    <script tal:content='string:
            Zenoss.env.CURRENT_CONTEXT = decodeURIComponent("${context/absolute_url_path}");
            Zenoss.env.REPORT_TITLE = "${here/id}";
        ' tal:on-error="string:"></script>
    
    <script>
      Ext.onReady(function(){
          var graphs = Ext.create('Zenoss.form.GraphPanel', {
              id: 'graph_report',
              renderTo: "graphs",
              tbarTitle: Zenoss.env.REPORT_TITLE,
              directFn: Zenoss.remote.ReportRouter.getGraphReportDefs,
              newWindowButton: false
           });
           
          graphs.setContext(Zenoss.env.CURRENT_CONTEXT);
          });
    </script>


<!-- END TABLE CONTENTS -->


</tal:block>

</form>
</tal:block>
</tal:block>
