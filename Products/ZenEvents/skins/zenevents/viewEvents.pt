<tal:block metal:use-macro="here/templates/macros/page2">
<tal:block metal:fill-slot="contentPane">

<script type="text/javascript" 
        src="/zport/portal_skins/zenmodel/zenmodelfuncs.js"></script>
<form method="post" tal:attributes="action request/URL"
    tal:define="
    whereclause request/ev_whereclause | here/eventWhere | string:;
    orderby request/ev_orderby | here/eventOrderby | string:;
    resultFields request/ev_resultfields | here/getResultFields | 
                    here/ZenEventManager/defaultResultFields;
    ">
<table class="zentable" cellpadding="3" cellspacing="1"
    metal:define-macro="eventTable"
    tal:define="tableName string:viewevents;
    ztm     here/ZenTableManager;
    deftsort python: ztm.getTableState(tableName,sortedHeader='');
    sevlevel python: ztm.setReqTableState(
                        tableName,'severity',default=2,reset=True);
    objects python:here.getEventList(severity=sevlevel);
    batch python:ztm.getBatch(tableName,objects);
    evcolspan python:len(resultFields)+1;"
    >
    <!--tal:on-error="structure here/eventsError"-->
    <tal:block metal:define-macro="listbody">
    <input type='hidden' name='tableName'
        tal:attributes="value tableName" />
    <input type='hidden' name='zenScreenName'
        tal:attributes="value template/id" />
    <tr>
        <td class="tabletitle" colspan=4 tal:attributes="colspan evcolspan">
            Events:
            &nbsp; &nbsp;
            Filter
            <input class="tableheader" type="text" name="filter" 
                size=25 onkeypress="submitViaEnter(event)"
                tal:attributes="value python:ztm.getTableState(
                                        tableName,'filter')">
            &nbsp; &nbsp;
            Severity Filter
            <select class="tableheader" name="severity:int"
                    onchange="this.form.submit()">
                <option tal:repeat="sev here/ZenEventManager/getSeverities"
                    tal:content="python:sev[0]"
                    tal:attributes="value python:sev[1]; 
                                    selected python:sev[1]==sevlevel" />
            </select>
        </td>
    </tr>
    <tr>
        <th tal:repeat="headername resultFields"
            tal:replace="structure python:ztm.getTableHeader(
                    tableName,headername,headername,'cmp')">Name
        </th>
        <th class=tableheader> </th>
    </tr>
    <tr tal:repeat="event batch" 
        tal:attributes="class event/getCssClass">
        <tal:block tal:repeat="data python:event.getDataList(resultFields)">
        <td tal:content="data">event data</td>
        </tal:block>
        <td>
            <a tal:attributes="href python:
                'javascript:popupwindow(\''+event.getEventDetailHref()
                +'\',\'ncoeventdetail'+str(event.evid)+'\',450,550)'">
                *
            </a>
        </td>
    </tr>
    <tr>
        <td class="tableheader" tal:attributes="colspan evcolspan">
            <span metal:use-macro=
                "here/zenTableNavigation/macros/navbodynofilter" />
        </td>
    </tr>
    </tal:block>
</table>
</form>    

</tal:block>
</tal:block>
