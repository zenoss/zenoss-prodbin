<tal:block metal:use-macro="here/templates/macros/page1">

<tal:block metal:fill-slot="breadCrumbPane">
    /<a tal:attributes="
            href string:${here/absolute_url_path}/${template/id}">Dashboard
   </a>
</tal:block>

<tal:block metal:fill-slot="contentPane">
    <script type="text/javascript">
    //display an event detail in its own native window
    eventWindow = function(manager, evid, width, height) {
        url = "/zport/dmd/"+manager+"/viewEventFields?evid=" + evid
        windowprops = "width=500,height=650,resizable=yes,scrollbars=yes";
        evwindow = window.open(url, evid, windowprops);
        evwindow.focus();
    }
    </script>
	<table class="zentable" cellpadding="3" cellspacing="1"
        tal:define="zem python:here.ZenEventManager;
        resultFields python:('device','summary','firstTime','lastTime','count');
        evcontrol python:0;
        evcolspan python:len(resultFields);
        batch python:zem.getEventList(severity=3,rows=5);"
        tal:on-error="structure here/eventsError"
        >
		<tr>
		  <th class="tabletitle" tal:attributes="colspan evcolspan">Events</th>
		</tr>
        <tr tal:condition="not:batch">
            <td class="tablevalues"> 
            No Events with Severity Error or Greater. 
            </td>
        </tr>
        <tal:block tal:condition="batch">
        <tr>
        <th class="tableheader" align="center" 
            tal:repeat="headername resultFields" tal:content="headername">
        </th>
        </tr>
        <tr tal:repeat="event batch" 
            tal:attributes="class event/getCssClass">
        <tal:block tal:define="evclick 
            string:javascript:eventWindow('${event/zem}','${event/evid}')">
        <td tal:repeat="data python:event.getDataListWithLinks(resultFields)"
            tal:attributes="onclick python:repeat['data'].end and evclick or ''"
            tal:content="structure data">
            event data
        </td>
        </tal:block>
        </tr>
        </tal:block>
    </table>
    <span metal:use-macro="here/templates/macros/contentSeparator"/>

	<table class="zentable" cellpadding="3" cellspacing="1">
		<tr>
		  <th class="tabletitle" colspan="6">Systems</th>
		</tr>
		<tr>
			<th class="tableheader">Name</th>
			<th class="tableheader">Events</th>
			<th class="tableheader">SubSystems</th>
			<th class="tableheader">Devices</th>
			<th class="tableheader">Ping</th>
			<th class="tableheader">Snmp</th>
		</tr>
		<tr tal:repeat="system python:here.getDmdRoot('Systems').children(True)">
			<td class="tablevalues">
				<a tal:attributes="href system/getPrimaryUrlPath"
					tal:content="system/getId">System</a>
			</td>
			<td class="tablevalues" align="left" width="25%">
			<table class="zentable" cellpadding="0" cellspacing="1"
				metal:define-macro="eventrainbow"
				tal:on-error="structure string:
					<span class='errorvalues'>Events unavailable</span>">
				<tr>
					<td align=center width=16%
					tal:repeat="evt system/getEventSummary"
					tal:attributes="class python:evt[0]">
						<span tal:replace="python:evt[1]">evtcnt</span>
					</td>
			  </tr>
			</table>
			</td>
			<td class="tablevalues" align="center" width="10%" 
                tal:content="system/countChildren"/>
			<td class="tablevalues" align="center" width="10%" 
				tal:content="system/countDevices"/>
			<td align="center" width="10%"  
                tal:define="pstatus python:system.getStatus('/Status/Ping')"
                tal:attributes="class python:system.getStatusCssClass(pstatus)"
                tal:content="python:here.convertStatus(pstatus)">0
            </td>
			<td align="center" width="10%" 
                tal:define="sstatus python:system.getStatus('/Status/Snmp')"
                tal:attributes="class python:system.getStatusCssClass(sstatus)"
                tal:content="python:here.convertStatus(sstatus)">0
            </td>
		</tr>
	</table>
    
    <span metal:use-macro="here/templates/macros/contentSeparator"/>

	<table class="zentable" cellpadding="3" cellspacing="1">
		<tr>
		  <th class="tabletitle" colspan="6">Devices</th>
		</tr>
		<tr>
			<th class="tableheader">Class</th>
			<th class="tableheader">Events</th>
			<th class="tableheader">SubClasses</th>
			<th class="tableheader">Devices</th>
			<th class="tableheader">Ping</th>
			<th class="tableheader">Snmp</th>
		</tr>
		<tr tal:repeat="dev python:here.getDmdRoot('Devices').children(True)">
			<td class="tablevalues">
				<a tal:attributes="href dev/getPrimaryUrlPath"
					tal:content="dev/getId">System</a>
			</td>
			<td class="tablevalues" align="left" width="25%">
			<table class="zentable" cellpadding="0" cellspacing="1"
				tal:on-error="structure string:
					<span class='errorvalues'>Events unavailable</span>">
				<tr>
					<td align=center width=16%
					tal:repeat="evt dev/getEventSummary"
					tal:attributes="class python:evt[0]">
						<span tal:replace="python:evt[1]">evtcnt</span>
					</td>
			  </tr>
			</table>
			</td>
			<td class="tablevalues" align="center" width="10%"
                tal:content="dev/countChildren"/>
			<td class="tablevalues" align="center" width="10%"
				tal:content="dev/countDevices"/>
			<td align="center" width="10%"
				tal:define="pstatus python:dev.getStatus('/Status/Ping')"
				tal:attributes="class python:dev.getStatusCssClass(pstatus)"
				tal:content="python:here.convertStatus(pstatus)">0
			</td>
			<td align="center" width="10%"
				tal:define="sstatus python:dev.getStatus('/Status/Snmp')"
				tal:attributes="class python:dev.getStatusCssClass(sstatus)"
				tal:content="python:here.convertStatus(sstatus)">0
			</td>
		</tr>
	</table>

</tal:block>
</tal:block>
