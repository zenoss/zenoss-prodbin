<tal:block metal:use-macro="here/templates/macros/page2">
<tal:block metal:fill-slot="contentPane">

<script type="text/javascript" src="/zport/js/zenutils.js"></script>
<script type="text/javascript" src="/zport/javascript/zengrid.js"></script>
<script type="text/javascript" 
        src="/zport/portal_skins/zenevents/zeneventsfuncs.js"></script>
<style>
</style>
<form name="control" method="post" 
    tal:attributes="action here/absolute_url_path"
    tal:define="
    zem python:here.ZenEventManager;
    whereclause request/ev_whereclause | here/eventWhere | string:;
    orderby request/ev_orderby | here/eventOrderby | string:;
    resultFields request/ev_resultfields | here/getResultFields | 
                    zem/defaultResultFields;
    evcontrol here/ZenEventManager/eventControls;
    evcolspan python:len(resultFields)+1+evcontrol+1;
    severity request/severity | python:2;
    state request/state | python:1;
    sortedHeader request/sortedHeader | string:;
    page string:getEventListPage;
    ">
<tal:block metal:define-macro="eventTable">
<tal:block tal:define="tabletitle string:Event List;menu_id string:Event_list">
<tal:block metal:use-macro="here/zenuimacros/macros/zentable">

<!-- Custom filter widgets -->
<tal:block metal:fill-slot="filterslot">    
<div class="temp_filterbox"> 
            Sev
            <select class="tableheader" name="severity:int" id="severity">
                <option tal:repeat="sev here/ZenEventManager/getSeverities"
                    tal:content="python:sev[0]"
                    tal:attributes="value python:sev[1]; 
                                    selected python:sev[1]==severity" />
            </select>
            &nbsp; &nbsp;
            State
            <select class="tableheader" name="state:int" id="state">
                <option tal:repeat="st here/ZenEventManager/getEventStates"
                    tal:content="python:st[0]"
                    tal:attributes="value python:st[1]; 
                                    selected python:st[1]==state" />
            </select>
            &nbsp; &nbsp;
            <input class="navcontrol" type="button" 
                name="refresh" value="Start Refresh"
                onclick="startRefresh(this, this.form);">
            <input class="tableheader" type="text" name="refreshRate" 
                size='2' value='60'>
        <div class="filterbox"
             tal:define=" tableName tableName | nothing;
                         ts request;
                         message request/SESSION/message | nothing;">
        <input type="text" name="filter" id="filter"
            onfocus="select(this)"
            tal:attributes="value ts/filter | string:;"/>
        </div>
        <style>.filterbox{position:relative;top:0px;
        left:0px;right:0px;bottom:0px;display:inline;
        padding-right:20px;margin-left:20px;}</style>
</div>
</tal:block>

<tal:block metal:fill-slot="zentablecontents">
<!-- BEGIN TABLE CONTENTS -->

    <tal:block metal:define-macro="header">
<!--
    <input type='hidden' name='sortedHeader' 
        tal:attributes="value sortedHeader"/>
    <input type='hidden' name='sortedSence' value="">
    <input type='hidden' name='url'
      tal:attributes="value string:${here/absolute_url_path}/${page}"/>
    <input type='hidden' name='zenScreenName'
        tal:attributes="value template/id" />
    <tr metal:define-macro="eventsHeader">
        <td class="tableheader" tal:condition="evcontrol">
        </td>
        <th class="tableheader" align="left" 
            tal:repeat="headername resultFields">
            <input type="button" class="navcontrol"
                tal:attributes="name headername; value headername"
                onclick="setSortedHeader(this.name, this.form);">
        </th>
        <td class="tableheader">
        </td>
    </tr>
    </tal:block>
    <tbody id="eventsBody">
        <span metal:use-macro="here/getEventListPage/macros/page"/>
    </tbody>
    <tal:block metal:define-macro="editor">
    <tr tal:condition="here/isManager">
    <td class="tableheader" tal:attributes="colspan evcolspan">
        <input class="tableheader" type="submit"
                name="SelectButton" value="Select All" 
                onClick="toggleSelect(this.form);return false"/>
    </td>
    </tr>
-->
    </tal:block>
<tr><td>

<style>
.leftfloat { float:left }
span.ruler,
td.cell {
    margin: 0px;
    overflow: hidden;
    white-space: nowrap;
    height: 32px;
    border-bottom: 1px solid #000;
    border-right: 1px solid #888;
    cursor: default;
    padding: 0;
}
.zg_headers td.cell {
    font-weight: bold;
    padding 0;
    border: medium none;
    border-left: 1px solid #888;
}
.zg_headers td.cell:hover {
    background-color: #888;
    color: white;
}
div.cell_inner {
    padding:0 3px;margin:0;
    overflow:hidden;
    white-space: normal;
    font-size: 12px;
    line-height: 132%;
    vertical-align: middle;
}
</style>

<div id="gridcontainer" style="width:100%;">

</div>

<script>
addLoadEvent( function() {
    var b = new ZenGridBuffer();
    var mygrid = new ZenGrid('gridcontainer', 'getJSONEventsInfo',
        'mygrid', b);
    connect('filter', 'onkeyup', mygrid.doEventLivesearch);
    connect('state', 'onchange', mygrid.refreshFromFormElement);
    connect('severity', 'onchange', mygrid.refreshFromFormElement);
});
</script>
</td></tr>
<!-- END TABLE CONTENTS -->
</tal:block>

</tal:block>

</tal:block>
</tal:block>
</form>    
</tal:block>
</tal:block>
